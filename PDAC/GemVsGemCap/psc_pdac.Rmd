---
title: "pdac_psc"
author: "Richard Jackson"
date: "2025-03-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




## Example

The psc.r package is available for downlaod from CRAN and is obtianed using

```{r}
#install.packages("psc")
library(psc)
```

## PDAC

Pancreatic Cancer is one of the most deadly cancers with over 10,000 new cased 
per year and a poor prognosis.  For 80% of patients the desease is either locally 
advanced or metastatic and whilst treatments are available, median survival is 
just 9 months.

For 20% of patietns, surgery to remove the cancer is an option.  Whilst 
prognosis improves, median survival remains modest (approx 2 years) with roughly 
30% of patietns living 5 years or more.

The European Study Group for Pancreatic Cacner (ESPAC) 4 study was a randomised
controlled trial to compare 2 types of chemotherapy following survery in the 20% 
who are eligible.  Seven hundred thirty two patients were randomised to two 
treatments; Gemcitabine (Gem: Control) and Gemcitbine plus Capecitabine 
(GemCap: Experimental). Ultimately this study was successful and demonstrate 
that GemCap can increase survival by approximately 3 months [HR= 0.82 
(0.44, 0.98); P=value=0.039].

The ESPAC4 study followed on fromt he competion of ESPAC3, a smilar study in the 
same population.  ESPAC3 also 1088 patients, 432 of which were randomised to 
receive Gemcitbine.

The aim here is to determine if the results of ESPAC4 can be replicated without 
the patients randomised to receive the control arm (Gem).  Instead a 
model for Gemcitbine, developed on the ESPAC3 data, will be used. 

Further detials on the use of this approach and discussion on the results have 
been publishers [REF]. Here we focus on the rocess and code syntax required to 
perform the analyses.

## Gemcitabine Model (The counter-factual model)

Full details on the setting, construction and the validation of the Gemcitbine 
model are included here: (https://richjjackson.github.io/mecPortal//models/pdac_gem.html).  
An Rshiny app has been to further describe the model (http://Need_an_url.com) and
the model is available for users to download in the github repository at (https://github.com/richJJackson/pscLibrary/tree/main/PDAC/GemVsGemCap)
CHANGE URL - MODEL ONLY FOLDER


NOTE HERE - need pscModel class
```{r}
setwd("~/Documents/GitHub/pscLibrary/PDAC/GemVsGemCap")
load("flexParaGem.R")
```

This model constructed is a flexible parametric survvial model ('fpm') and has class 
'flexsurvreg' and standard base functions can be used to explroe the model

```{r}
print(fpm)
plot(fpm)
```


## ESPAC 4 data

An anonymised subset of the data from the trial are used for this example and are
available at (https://github.com/richJJackson/pscLibrary/tree/main/PDAC/GemVsGemCap).
Data are available in .csv format:

```{r}
e4 <- read.csv("e4_data_cohort.csv")
head(e4)
```


## Summary compariosns

The first step to comparing the espac 4 data to the Gem model is to ensure that 
the two sources of data are compatible.  In practice the means esnuring that for 
each covariate in the model, there exists an equivalent covariate in the dataset.
Care should be applied to ensure that these covaraites match, are vectors of the 
same class and are measured on the same scale.

dataComb
data_match






THe model itself are is available from the Gih



## Including Plots


```{r pressure, echo=FALSE}
plot(pressure)
```

